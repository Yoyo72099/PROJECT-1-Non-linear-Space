<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Non-Linear Text — Deconstructed Canvas</title>
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,700;1,400&family=DM+Sans:wght@300;400;500&display=swap" rel="stylesheet">
<style>
  :root {
    --bg: #0e0e0e;
    --text: #e8e4df;
    --accent: #c9a87c;
    --muted: #6b6560;
    --surface: #1a1917;
  }

  * { margin: 0; padding: 0; box-sizing: border-box; }

  body {
    /* ========== 背景图片：替换下面的URL ========== */
    background: var(--bg) url('https://github.com/Yoyo72099/PROJECT-1-Non-linear-Space/blob/main/截屏2026-02-10%20下午5.06.52.png?raw=true') center/cover fixed;
    /* ============================================= */
    color: var(--text);
    font-family: 'DM Sans', sans-serif;
    min-height: 100vh;
    overflow-x: hidden;
  }

  body::before {
    content: '';
    position: fixed;
    inset: 0;
    background: rgba(14,14,14,0.82);
    z-index: 0;
  }

  .page-wrapper {
    position: relative;
    z-index: 1;
    max-width: 1200px;
    margin: 0 auto;
    padding: 40px 24px 80px;
  }

  header {
    text-align: center;
    margin-bottom: 40px;
    animation: fadeDown 1s ease;
  }

  .reset-btn {
    display: none;
    margin: 0 auto;
    background: var(--surface);
    border: 1px solid rgba(201,168,124,0.25);
    color: var(--text);
    padding: 10px 32px;
    border-radius: 4px;
    font-family: 'DM Sans', sans-serif;
    font-size: 0.85rem;
    letter-spacing: 0.08em;
    text-transform: uppercase;
    cursor: pointer;
    transition: all 0.25s;
  }

  .reset-btn:hover {
    background: rgba(201,168,124,0.12);
    border-color: var(--accent);
    color: var(--accent);
  }

  .reset-btn.visible {
    display: inline-block;
    animation: fadeDown 0.5s ease;
  }

  /* ====== Canvas Area ====== */
  .canvas-container {
    position: relative;
    width: 100%;
    max-width: 900px;
    margin: 0 auto;
    background: var(--surface);
    border: 1px solid rgba(201,168,124,0.15);
    border-radius: 4px;
    padding: 20px;
    box-shadow: 0 30px 80px rgba(0,0,0,0.5);
    animation: fadeUp 1s ease 0.2s both;
  }

  .painting-frame {
    position: relative;
    width: 100%;
    aspect-ratio: 4/3;
    overflow: hidden;
    cursor: default;
    border: 3px solid rgba(201,168,124,0.25);
    user-select: none;
  }

  .painting-frame img.original-painting {
    width: 100%;
    height: 100%;
    object-fit: cover;
    display: block;
    transition: opacity 0.3s;
  }

  /* ====== Pieces Layer ====== */
  .pieces-layer {
    position: absolute;
    inset: 0;
    display: none;
  }

  .pieces-layer.active {
    display: block;
  }

  .piece {
    position: absolute;
    overflow: hidden;
    cursor: grab;
    transition: box-shadow 0.2s, transform 0.15s;
    border: 1px solid rgba(255,255,255,0.08);
  }

  .piece:hover {
    box-shadow: 0 8px 30px rgba(0,0,0,0.6);
    z-index: 100 !important;
  }

  .piece.dragging {
    cursor: grabbing;
    box-shadow: 0 15px 50px rgba(0,0,0,0.8);
    z-index: 999 !important;
    transition: box-shadow 0.2s;
  }

  .piece .piece-inner {
    width: 100%;
    height: 100%;
    background-size: cover;
    background-repeat: no-repeat;
  }

  /* ====== Scissors Cursor ====== */
  .scissors-mode .painting-frame {
    cursor: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='32' height='32' viewBox='0 0 24 24' fill='none' stroke='%23c9a87c' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Ccircle cx='6' cy='6' r='3'/%3E%3Ccircle cx='6' cy='18' r='3'/%3E%3Cline x1='20' y1='4' x2='8.12' y2='15.88'/%3E%3Cline x1='14.47' y1='14.48' x2='20' y2='20'/%3E%3Cline x1='8.12' y1='8.12' x2='12' y2='12'/%3E%3C/svg%3E") 12 12, crosshair;
  }

  /* ====== Cut Lines Preview ====== */
  .cut-line {
    position: absolute;
    background: var(--accent);
    opacity: 0.6;
    pointer-events: none;
    z-index: 50;
  }

  .cut-line.h {
    height: 2px;
    width: 100%;
    left: 0;
    animation: cutFlash 0.4s ease;
  }

  .cut-line.v {
    width: 2px;
    height: 100%;
    top: 0;
    animation: cutFlash 0.4s ease;
  }

  /* ====== Hint Toast ====== */
  .hint-toast {
    position: fixed;
    bottom: 30px;
    left: 50%;
    transform: translateX(-50%) translateY(100px);
    background: var(--surface);
    border: 1px solid rgba(201,168,124,0.3);
    color: var(--text);
    padding: 14px 28px;
    border-radius: 50px;
    font-size: 0.85rem;
    letter-spacing: 0.04em;
    z-index: 1000;
    opacity: 0;
    transition: all 0.5s cubic-bezier(0.34, 1.56, 0.64, 1);
    pointer-events: none;
    white-space: nowrap;
  }

  .hint-toast.show {
    opacity: 1;
    transform: translateX(-50%) translateY(0);
  }

  .hint-toast .scissors-icon {
    display: inline-block;
    margin-right: 8px;
    vertical-align: middle;
  }

  /* ====== Toolbar ====== */
  .toolbar {
    display: none;
    justify-content: center;
    gap: 12px;
    margin-top: 20px;
    animation: fadeUp 0.5s ease;
  }

  .toolbar.active {
    display: flex;
  }

  .toolbar button {
    background: var(--surface);
    border: 1px solid rgba(201,168,124,0.25);
    color: var(--text);
    padding: 10px 22px;
    border-radius: 4px;
    font-family: 'DM Sans', sans-serif;
    font-size: 0.82rem;
    letter-spacing: 0.06em;
    cursor: pointer;
    transition: all 0.25s;
    text-transform: uppercase;
  }

  .toolbar button:hover {
    background: rgba(201,168,124,0.12);
    border-color: var(--accent);
    color: var(--accent);
  }

  .toolbar button.active-tool {
    background: rgba(201,168,124,0.15);
    border-color: var(--accent);
    color: var(--accent);
  }

  /* ====== Cut counter ====== */
  .cut-info {
    text-align: center;
    margin-top: 14px;
    font-size: 0.78rem;
    color: var(--muted);
    letter-spacing: 0.05em;
    display: none;
  }

  .cut-info.active { display: block; }

  /* ====== Scatter animation ====== */
  .piece.scatter {
    transition: transform 0.8s cubic-bezier(0.34, 1.56, 0.64, 1),
                opacity 0.3s;
  }

  /* ====== Credits ====== */
  .credits {
    text-align: center;
    margin-top: 50px;
    font-size: 0.75rem;
    color: var(--muted);
    letter-spacing: 0.1em;
    text-transform: uppercase;
  }

  @keyframes fadeDown {
    from { opacity: 0; transform: translateY(-20px); }
    to { opacity: 1; transform: translateY(0); }
  }

  @keyframes fadeUp {
    from { opacity: 0; transform: translateY(20px); }
    to { opacity: 1; transform: translateY(0); }
  }

  @keyframes cutFlash {
    0% { opacity: 0; }
    50% { opacity: 1; }
    100% { opacity: 0.6; }
  }

  /* Mobile */
  @media (max-width: 600px) {
    .page-wrapper { padding: 20px 12px 60px; }
    .canvas-container { padding: 10px; }
    .toolbar button { padding: 8px 14px; font-size: 0.75rem; }
  }
</style>
</head>
<body>

<div class="page-wrapper">
  <header>
    <button class="reset-btn" id="resetBtnTop">Reset</button>
  </header>

  <div class="canvas-container">
    <div class="painting-frame" id="paintingFrame">

      <!-- ========== 画作图片：替换下面的src ========== -->
      <img class="original-painting" id="originalPainting"
           src="https://github.com/Yoyo72099/PROJECT-1-Non-linear-Space/blob/main/截屏2026-02-10%20下午5.09.31.png?raw=true"
           alt="Painting" />
      <!-- ============================================= -->

      <div class="pieces-layer" id="piecesLayer"></div>
    </div>
  </div>

  <div class="toolbar" id="toolbar">
    <button id="btnCutH" title="Add horizontal cut">✂ Horizontal Cut</button>
    <button id="btnCutV" title="Add vertical cut">✂ Vertical Cut</button>
    <button id="btnScatter" title="Scatter pieces apart">Scatter</button>
    <button id="btnReset" title="Reset to original">Reset</button>
  </div>

  <div class="cut-info" id="cutInfo">
    Drag pieces to rearrange · <span id="pieceCount">0</span> pieces
  </div>

  <div class="credits">
    Double-click the painting to discover the hidden tool
  </div>
</div>

<div class="hint-toast" id="hintToast">
  <svg class="scissors-icon" width="18" height="18" viewBox="0 0 24 24" fill="none"
       stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
    <circle cx="6" cy="6" r="3"/><circle cx="6" cy="18" r="3"/>
    <line x1="20" y1="4" x2="8.12" y2="15.88"/>
    <line x1="14.47" y1="14.48" x2="20" y2="20"/>
    <line x1="8.12" y1="8.12" x2="12" y2="12"/>
  </svg>
  <span id="hintText">Scissors unlocked! Use the toolbar to cut.</span>
</div>

<script>
(() => {
  const frame = document.getElementById('paintingFrame');
  const originalImg = document.getElementById('originalPainting');
  const piecesLayer = document.getElementById('piecesLayer');
  const toolbar = document.getElementById('toolbar');
  const cutInfo = document.getElementById('cutInfo');
  const pieceCountEl = document.getElementById('pieceCount');
  const hintToast = document.getElementById('hintToast');
  const hintText = document.getElementById('hintText');

  const btnCutH = document.getElementById('btnCutH');
  const btnCutV = document.getElementById('btnCutV');
  const btnScatter = document.getElementById('btnScatter');
  const btnReset = document.getElementById('btnReset');
  const resetBtnTop = document.getElementById('resetBtnTop');

  let scissorsUnlocked = false;
  let dblClickCount = 0;
  let dblClickTimer = null;

  // Horizontal and vertical cut positions (as fractions 0-1)
  let hCuts = [];
  let vCuts = [];
  let isCut = false;

  // ====== Double-click Easter Egg ======
  frame.addEventListener('dblclick', (e) => {
    if (scissorsUnlocked || isCut) return;

    dblClickCount++;

    if (dblClickCount === 1) {
      showHint('One more double-click to unlock ✂');
      dblClickTimer = setTimeout(() => { dblClickCount = 0; }, 3000);
    }

    if (dblClickCount >= 2) {
      clearTimeout(dblClickTimer);
      dblClickCount = 0;
      unlockScissors();
    }
  });

  function unlockScissors() {
    scissorsUnlocked = true;
    frame.classList.add('scissors-mode');
    toolbar.classList.add('active');
    cutInfo.classList.add('active');
    resetBtnTop.classList.add('visible');
    showHint('✂ Scissors unlocked! Cut the painting and rearrange.');
    // Add default cuts
    addCut('h', 0.33);
    addCut('h', 0.66);
    addCut('v', 0.33);
    addCut('v', 0.66);
    applyCuts();
  }

  // ====== Cut Logic ======
  function addCut(type, pos) {
    if (type === 'h') {
      if (hCuts.length >= 4) return;
      hCuts.push(pos);
      hCuts.sort((a, b) => a - b);
    } else {
      if (vCuts.length >= 4) return;
      vCuts.push(pos);
      vCuts.sort((a, b) => a - b);
    }
  }

  btnCutH.addEventListener('click', () => {
    if (hCuts.length >= 4) { showHint('Max 4 horizontal cuts'); return; }
    // Add at a random position avoiding existing ones
    let pos;
    do { pos = 0.15 + Math.random() * 0.7; }
    while (hCuts.some(c => Math.abs(c - pos) < 0.08));
    addCut('h', pos);
    applyCuts();
  });

  btnCutV.addEventListener('click', () => {
    if (vCuts.length >= 4) { showHint('Max 4 vertical cuts'); return; }
    let pos;
    do { pos = 0.15 + Math.random() * 0.7; }
    while (vCuts.some(c => Math.abs(c - pos) < 0.08));
    addCut('v', pos);
    applyCuts();
  });

  btnScatter.addEventListener('click', scatterPieces);
  btnReset.addEventListener('click', resetAll);
  resetBtnTop.addEventListener('click', fullReset);

  function fullReset() {
    hCuts = [];
    vCuts = [];
    isCut = false;
    scissorsUnlocked = false;
    dblClickCount = 0;
    piecesLayer.classList.remove('active');
    piecesLayer.innerHTML = '';
    originalImg.style.opacity = '1';
    originalImg.style.pointerEvents = 'auto';
    frame.classList.remove('scissors-mode');
    toolbar.classList.remove('active');
    cutInfo.classList.remove('active');
    resetBtnTop.classList.remove('visible');
  }

  function applyCuts() {
    isCut = true;
    originalImg.style.opacity = '0';
    originalImg.style.pointerEvents = 'none';
    piecesLayer.classList.add('active');
    piecesLayer.innerHTML = '';

    const frameW = frame.offsetWidth;
    const frameH = frame.offsetHeight;
    const imgSrc = originalImg.src;

    // Build grid boundaries
    const rows = [0, ...hCuts, 1];
    const cols = [0, ...vCuts, 1];

    let count = 0;
    for (let r = 0; r < rows.length - 1; r++) {
      for (let c = 0; c < cols.length - 1; c++) {
        const x1 = cols[c], x2 = cols[c + 1];
        const y1 = rows[r], y2 = rows[r + 1];

        const piece = document.createElement('div');
        piece.className = 'piece';
        piece.style.left = (x1 * 100) + '%';
        piece.style.top = (y1 * 100) + '%';
        piece.style.width = ((x2 - x1) * 100) + '%';
        piece.style.height = ((y2 - y1) * 100) + '%';

        // Store original position
        piece.dataset.origLeft = (x1 * 100) + '%';
        piece.dataset.origTop = (y1 * 100) + '%';

        const inner = document.createElement('div');
        inner.className = 'piece-inner';
        // Use background-position to show correct portion
        const bgPosX = (x1 / (x2 - x1)) * -100;
        const bgPosY = (y1 / (y2 - y1)) * -100;
        const bgSizeX = 1 / (x2 - x1) * 100;
        const bgSizeY = 1 / (y2 - y1) * 100;

        inner.style.backgroundImage = `url("${imgSrc}")`;
        inner.style.backgroundSize = `${bgSizeX}% ${bgSizeY}%`;
        inner.style.backgroundPosition = `${-x1 * frameW / ((x2 - x1) * frameW) * 100}% ${-y1 * frameH / ((y2 - y1) * frameH) * 100}%`;

        // Simpler approach: use pixel-based positioning
        inner.style.backgroundSize = `${frameW}px ${frameH}px`;
        inner.style.backgroundPosition = `${-x1 * frameW}px ${-y1 * frameH}px`;
        inner.style.width = `${(x2 - x1) * frameW}px`;
        inner.style.height = `${(y2 - y1) * frameH}px`;

        piece.appendChild(inner);
        piecesLayer.appendChild(piece);
        makeDraggable(piece);
        count++;
      }
    }

    pieceCountEl.textContent = count;

    // Draw cut lines
    hCuts.forEach(pos => {
      const line = document.createElement('div');
      line.className = 'cut-line h';
      line.style.top = (pos * 100) + '%';
      piecesLayer.appendChild(line);
    });

    vCuts.forEach(pos => {
      const line = document.createElement('div');
      line.className = 'cut-line v';
      line.style.left = (pos * 100) + '%';
      piecesLayer.appendChild(line);
    });
  }

  // ====== Drag Logic ======
  function makeDraggable(el) {
    let startX, startY, origX, origY;
    let isDragging = false;

    const onStart = (e) => {
      e.preventDefault();
      isDragging = true;
      el.classList.add('dragging');

      const touch = e.touches ? e.touches[0] : e;
      const rect = piecesLayer.getBoundingClientRect();

      origX = el.offsetLeft;
      origY = el.offsetTop;
      startX = touch.clientX;
      startY = touch.clientY;

      // Bring to front
      el.style.zIndex = 200;
    };

    const onMove = (e) => {
      if (!isDragging) return;
      e.preventDefault();
      const touch = e.touches ? e.touches[0] : e;
      const dx = touch.clientX - startX;
      const dy = touch.clientY - startY;
      el.style.left = origX + dx + 'px';
      el.style.top = origY + dy + 'px';
    };

    const onEnd = () => {
      isDragging = false;
      el.classList.remove('dragging');
    };

    el.addEventListener('mousedown', onStart);
    document.addEventListener('mousemove', onMove);
    document.addEventListener('mouseup', onEnd);

    el.addEventListener('touchstart', onStart, { passive: false });
    document.addEventListener('touchmove', onMove, { passive: false });
    document.addEventListener('touchend', onEnd);
  }

  // ====== Scatter ======
  function scatterPieces() {
    const pieces = piecesLayer.querySelectorAll('.piece');
    const fw = frame.offsetWidth;
    const fh = frame.offsetHeight;

    pieces.forEach(p => {
      p.classList.add('scatter');
      const rx = (Math.random() - 0.5) * fw * 0.5;
      const ry = (Math.random() - 0.5) * fh * 0.5;
      const rot = (Math.random() - 0.5) * 30;
      p.style.transform = `translate(${rx}px, ${ry}px) rotate(${rot}deg)`;
    });
  }

  // ====== Reset ======
  function resetAll() {
    hCuts = [];
    vCuts = [];
    isCut = false;
    piecesLayer.classList.remove('active');
    piecesLayer.innerHTML = '';
    originalImg.style.opacity = '1';
    originalImg.style.pointerEvents = 'auto';

    if (scissorsUnlocked) {
      // Keep scissors but reset cuts
      hCuts = [0.33, 0.66];
      vCuts = [0.33, 0.66];
      applyCuts();
    }
  }

  // ====== Toast ======
  function showHint(text) {
    hintText.textContent = text;
    hintToast.classList.add('show');
    setTimeout(() => hintToast.classList.remove('show'), 3000);
  }

  // Show initial hint after a delay
  setTimeout(() => {
    if (!scissorsUnlocked) {
      showHint('Try double-clicking the painting…');
    }
  }, 4000);
})();
</script>
</body>
</html>
